You can use regex in the output sections.
More info here: https://github.com/manticoresoftware/clt#refine
Time taken for test: 99324ms
â€“â€“â€“ input â€“â€“â€“
(dockerd > /var/log/dockerd.log 2>&1 &) > /dev/null
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ duration: 1ms (0.00%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
if timeout 60 grep -qm1 'API listen on /var/run/docker.sock' <(tail -n 0 -f /var/log/dockerd.log); then echo 'Done'; else echo 'Timeout failed'; fi
â€“â€“â€“ output â€“â€“â€“
Done
â€“â€“â€“ duration: 2021ms (2.03%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker ps
â€“â€“â€“ output â€“â€“â€“
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
â€“â€“â€“ duration: 84ms (0.08%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker build --build-arg="DEV=1" -t manticoresoftware/manticore:current /docker/ > /dev/null 2>&1; echo $?
â€“â€“â€“ output â€“â€“â€“
0
â€“â€“â€“ duration: 85511ms (86.09%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker run --rm -e EXTRA=1 --name manticore -v /tmp/idx:/var/lib/manticore -d manticoresoftware/manticore:current
â€“â€“â€“ output â€“â€“â€“
28ccfda70b9bcb59c85baad0d67fdbd4f07c960b0092e356f6a9dadfa8d3f91b
â€“â€“â€“ duration: 174ms (0.18%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
if timeout 60 grep -qEm1 "columnar.*?secondary.*?knn" <(docker logs -f manticore 2>&1); then echo 'Done'; else echo 'Not found'; fi
â€“â€“â€“ output â€“â€“â€“
Done
â€“â€“â€“ duration: 3335ms (3.36%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore manticore-executor -v
â€“â€“â€“ output â€“â€“â€“
PHP 8.2.8 (cli) (built: Jun  6 2024 11:38:17) (NTS)
Copyright (c) The PHP Group
Zend Engine v4.2.8, Copyright (c) Zend Technologies
â€“â€“â€“ duration: 52ms (0.05%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore wget -q https://raw.githubusercontent.com/manticoresoftware/manticoresearch-backup/main/test/clt-tests/dumps/tables.sql
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ duration: 957ms (0.96%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore bash -c "mysql < ./tables.sql"
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ duration: 73ms (0.07%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show tables"
â€“â€“â€“ output â€“â€“â€“
+---------------------+-------------+
| Index               | Type        |
+---------------------+-------------+
| distributed_index   | distributed |
| rt_with_columnar    | rt          |
| rt_without_columnar | rt          |
| test                | rt          |
+---------------------+-------------+
â€“â€“â€“ duration: 34ms (0.03%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table distributed_index"
â€“â€“â€“ output â€“â€“â€“
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table             | Create Table                                                                                                                                                              |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| distributed_index | CREATE TABLE distributed_index type='distributed' local='rt_with_columnar' local='rt_without_columnar' agent='127.0.0.1:9312:plain_with_columnar, plain_without_columnar' |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 45ms (0.05%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table rt_with_columnar"
â€“â€“â€“ output â€“â€“â€“
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table            | Create Table                                                                                                                                                           |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| rt_with_columnar | CREATE TABLE rt_with_columnar (
id bigint,
title text,
category_id integer,
price float,
description string attribute engine='columnar',
tags multi,
attributes json
) |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 34ms (0.03%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table rt_without_columnar"
â€“â€“â€“ output â€“â€“â€“
+---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table               | Create Table                                                                                                                                            |
+---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| rt_without_columnar | CREATE TABLE rt_without_columnar (
id bigint,
title text,
category_id integer,
price float,
description string attribute,
tags multi,
attributes json
) |
+---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 34ms (0.03%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table test"
â€“â€“â€“ output â€“â€“â€“
+-------+--------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                             |
+-------+--------------------------------------------------------------------------------------------------------------------------+
| test  | CREATE TABLE test (
id bigint,
title text,
image_vector float_vector knn_type='hnsw' knn_dims='4' hnsw_similarity='L2'
) |
+-------+--------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 31ms (0.03%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec -it manticore manticore-backup --backup-dir=/tmp
â€“â€“â€“ output â€“â€“â€“
Copyright (c) 2023-2024, Manticore Software LTD (https://manticoresearch.com)
Manticore config file: /etc/manticoresearch/manticore.conf.sh
Tables to backup: all tables
Backup dir: /tmp
Manticore config
endpoint =  http://127.0.0.1:9308
Manticore config
endpoint =  http://127.0.0.1:9312
Manticore versions:
manticore: 6.3.3 66b44759a@24071711 dev
columnar: 2.3.1 42f2b06@24070110
secondary: 2.3.1 42f2b06@24070110
knn: 2.3.1 42f2b06@24070110
buddy: 2.3.13
[93m2024-07-17 20:14:47[0m [Info] Starting the backup...
[93m2024-07-17 20:14:47[0m [Info] Backing up config files...
[93m2024-07-17 20:14:47[0m [Info]   config files - [92mOK[0m
[93m2024-07-17 20:14:47[0m [Info] Backing up global state files...
[93m2024-07-17 20:14:47[0m [Info]   global state files â€“ [92mOK[0m
[93m2024-07-17 20:14:47[0m [Info] Backing up tables...
[93m2024-07-17 20:14:47[0m [Info]   distributed_index (distributed)...
[93m2024-07-17 20:14:47[0m [Info]   [93mSKIP[0m
[93m2024-07-17 20:14:47[0m [Info]   rt_with_columnar (rt) [2.884K]...
[93m2024-07-17 20:14:47[0m [Info]    [92mOK[0m
[93m2024-07-17 20:14:47[0m [Info]   rt_without_columnar (rt) [2.758K]...
[93m2024-07-17 20:14:47[0m [Info]    [92mOK[0m
[93m2024-07-17 20:14:47[0m [Info]   test (rt) [924B]...
[93m2024-07-17 20:14:47[0m [Info]    [92mOK[0m
[93m2024-07-17 20:14:47[0m [Info] Running sync
[93m2024-07-17 20:14:47[0m [Info]  [92mOK[0m
[93m2024-07-17 20:14:47[0m [Info] You can find backup here: /tmp/backup-20240717201447
[93m2024-07-17 20:14:47[0m [Info] Elapsed time: 0.29s
[93m2024-07-17 20:14:48[0m [Info] Done
â€“â€“â€“ duration: 1751ms (1.76%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
BACKUP_NAME=$(docker exec manticore ls /tmp/ | grep backup-*)
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ duration: 49ms (0.05%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker cp manticore:/tmp/$BACKUP_NAME /tmp/$BACKUP_NAME > /dev/null 2>&1; echo $?
â€“â€“â€“ output â€“â€“â€“
0
â€“â€“â€“ duration: 12ms (0.01%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
chmod -R 777 /tmp/$BACKUP_NAME
â€“â€“â€“ output â€“â€“â€“
â€“â€“â€“ duration: 1ms (0.00%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker stop manticore
â€“â€“â€“ output â€“â€“â€“
manticore
â€“â€“â€“ duration: 1096ms (1.10%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker ps
â€“â€“â€“ output â€“â€“â€“
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
â€“â€“â€“ duration: 9ms (0.01%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker run -d -e EXTRA=1 --name manticore -v /tmp/$BACKUP_NAME:/docker-entrypoint-initdb.d manticoresoftware/manticore:current
â€“â€“â€“ output â€“â€“â€“
bf275693e59c71b095714a89180172d7c344f93efc233621b6e32e072947ffe2
â€“â€“â€“ duration: 122ms (0.12%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
if timeout 60 grep -qEm1 "accepting connections" <(docker logs -f manticore 2>&1); then echo 'Manticore is running'; else echo 'Failed to start Manticore'; docker logs manticore; fi
â€“â€“â€“ output â€“â€“â€“
Manticore is running
â€“â€“â€“ duration: 3696ms (3.72%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show tables"
â€“â€“â€“ output â€“â€“â€“
+---------------------+-------------+
| Index               | Type        |
+---------------------+-------------+
| distributed_index   | distributed |
| rt_with_columnar    | rt          |
| rt_without_columnar | rt          |
| test                | rt          |
+---------------------+-------------+
â€“â€“â€“ duration: 65ms (0.07%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table distributed_index"
â€“â€“â€“ output â€“â€“â€“
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table             | Create Table                                                                                                                                                              |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| distributed_index | CREATE TABLE distributed_index type='distributed' local='rt_with_columnar' local='rt_without_columnar' agent='127.0.0.1:9312:plain_with_columnar, plain_without_columnar' |
+-------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 38ms (0.04%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table rt_with_columnar"
â€“â€“â€“ output â€“â€“â€“
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table            | Create Table                                                                                                                                                           |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| rt_with_columnar | CREATE TABLE rt_with_columnar (
id bigint,
title text,
category_id integer,
price float,
description string attribute engine='columnar',
tags multi,
attributes json
) |
+------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 32ms (0.03%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table rt_without_columnar"
â€“â€“â€“ output â€“â€“â€“
+---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| Table               | Create Table                                                                                                                                            |
+---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
| rt_without_columnar | CREATE TABLE rt_without_columnar (
id bigint,
title text,
category_id integer,
price float,
description string attribute,
tags multi,
attributes json
) |
+---------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 31ms (0.03%) â€“â€“â€“
â€“â€“â€“ input â€“â€“â€“
docker exec manticore mysql -e "show create table test"
â€“â€“â€“ output â€“â€“â€“
+-------+--------------------------------------------------------------------------------------------------------------------------+
| Table | Create Table                                                                                                             |
+-------+--------------------------------------------------------------------------------------------------------------------------+
| test  | CREATE TABLE test (
id bigint,
title text,
image_vector float_vector knn_type='hnsw' knn_dims='4' hnsw_similarity='L2'
) |
+-------+--------------------------------------------------------------------------------------------------------------------------+
â€“â€“â€“ duration: 36ms (0.04%) â€“â€“â€“
